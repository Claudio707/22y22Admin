<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>22y22 S.A.S.</title>

<style>
:root{
 --bg:#121416;
 --surface:#25282c;
 --platinum:#e5e4e2;
 --text:#ffffff;
 --danger:#ff4d4d;
}
body{
 background:var(--bg);
 color:var(--text);
 font-family:Segoe UI,sans-serif;
 margin:0;
 display:flex;
 height:100vh;
 overflow:hidden;
}
nav{
 width:240px;
 background:var(--surface);
 padding:20px;
 display:flex;
 flex-direction:column;
}
.nav-btn{
 padding:12px;
 background:none;
 border:none;
 color:#aaa;
 cursor:pointer;
 border-radius:6px;
 margin-bottom:5px;
 text-align:left;
}
.nav-btn.active{
 background:var(--platinum);
 color:var(--bg);
 font-weight:bold;
}
main{
 flex:1;
 padding:30px;
 overflow-y:auto;
}
.card{
 background:var(--surface);
 padding:20px;
 border-radius:10px;
 margin-bottom:20px;
}
.grid{
 display:grid;
 grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
 gap:15px;
}
input,select{
 background:#121416;
 border:1px solid #444;
 color:white;
 padding:10px;
 border-radius:6px;
 width:100%;
}
button{
 padding:10px;
 border:none;
 border-radius:6px;
 cursor:pointer;
 font-weight:bold;
}
.btn-main{
 background:var(--platinum);
 color:var(--bg);
}
.btn-danger{
 background:var(--danger);
 color:white;
}
.hidden{display:none;}
table{
 width:100%;
 border-collapse:collapse;
}
th,td{
 padding:10px;
 border-bottom:1px solid #333;
}
</style>
</head>

<body>

<nav>
<h2>22y22 S.A.S.</h2>
<button class="nav-btn active" onclick="mostrar('ventas',this)">Ventas</button>
<button class="nav-btn" onclick="mostrar('produccion',this)">Producción</button>
<button class="nav-btn" onclick="mostrar('egresos',this)">Egresos</button>
<button class="nav-btn" onclick="mostrar('config',this)">Configuración</button>
<button class="nav-btn" onclick="mostrar('cierre',this)">Cierre Diario</button>
</nav>

<main>

<!-- VENTAS -->
<section id="ventas">
<h2>Punto de Venta</h2>

<div class="card grid">
<div>
<label>Producto</label>
<select id="vProd"></select>
</div>
<div>
<label>Cantidad</label>
<input type="number" id="vCant" value="1">
</div>
<div style="display:flex;align-items:end;">
<button class="btn-main" onclick="agregarCarrito()">Agregar</button>
</div>
</div>

<div class="card">
<table>
<thead>
<tr>
<th>Producto</th>
<th>Cant</th>
<th>Total</th>
<th></th>
</tr>
</thead>
<tbody id="carritoBody"></tbody>
</table>

<h2>Total: $<span id="totalVenta">0</span></h2>
<button class="btn-main" style="width:100%" onclick="guardarVenta()">Guardar Venta</button>
</div>
</section>

<!-- PRODUCCIÓN -->
<section id="produccion" class="hidden">
<h2>Control Producción</h2>

<div class="card grid">
<input type="number" id="pozoInicio" placeholder="Lectura Inicial m³">
<input type="number" id="pozoFinal" placeholder="Lectura Final m³">
<button class="btn-main" onclick="calcularProduccion()">Calcular</button>
</div>

<div id="resultadoProduccion"></div>
</section>

<!-- EGRESOS -->
<section id="egresos" class="hidden">
<h2>Egresos</h2>

<div class="card grid">
<input type="text" id="eConcepto" placeholder="Concepto">
<input type="number" id="eMonto" placeholder="Monto">
<button class="btn-main" onclick="guardarEgreso()">Guardar</button>
</div>

<div id="listaEgresos"></div>
</section>

<!-- CONFIG -->
<section id="config" class="hidden">
<div class="card">
<h3>Agregar Producto</h3>
<input type="text" id="pNombre" placeholder="Nombre">
<input type="number" id="pPrecio" placeholder="Precio">
<input type="number" id="pLitros" placeholder="Litros">
<button class="btn-main" onclick="guardarProducto()">Guardar</button>
</div>

<div class="card">
<h3>Productos</h3>
<table>
<thead><tr><th>Nombre</th><th></th></tr></thead>
<tbody id="tablaProductos"></tbody>
</table>
</div>
</section>

<!-- CIERRE -->
<section id="cierre" class="hidden">
<h2>Cierre Diario</h2>
<div id="informeCierre"></div>
<button class="btn-main" onclick="generarCierre()">Generar Informe</button>
</section>

</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc }
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
 apiKey:"TU_APIKEY",
 authDomain:"TU_AUTHDOMAIN",
 projectId:"TU_PROJECTID",
 storageBucket:"TU_BUCKET",
 messagingSenderId:"TU_MSGID",
 appId:"TU_APPID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let carrito=[];

/* NAVEGACIÓN */
window.mostrar=(sec,btn)=>{
 document.querySelectorAll("section").forEach(s=>s.classList.add("hidden"));
 document.querySelectorAll(".nav-btn").forEach(b=>b.classList.remove("active"));
 document.getElementById(sec).classList.remove("hidden");
 if(btn) btn.classList.add("active");
};

/* PRODUCTOS */
window.guardarProducto=async()=>{
 const nombre=document.getElementById("pNombre").value;
 const precio=parseFloat(document.getElementById("pPrecio").value);
 const litros=parseFloat(document.getElementById("pLitros").value);

 if(!nombre || !precio) return alert("Completar datos");

 await addDoc(collection(db,"productos"),{nombre,precio,litros});
 cargarProductos();
};

async function cargarProductos(){
 const query=await getDocs(collection(db,"productos"));
 const tabla=document.getElementById("tablaProductos");
 const select=document.getElementById("vProd");

 tabla.innerHTML="";
 select.innerHTML="";

 query.forEach(docu=>{
  const p=docu.data();

  tabla.innerHTML+=`
   <tr>
    <td>${p.nombre}</td>
    <td><button class="btn-danger" onclick="eliminarProducto('${docu.id}')">X</button></td>
   </tr>`;

  select.innerHTML+=`
   <option value="${docu.id}" 
   data-precio="${p.precio}" 
   data-litros="${p.litros}">
   ${p.nombre} ($${p.precio})
   </option>`;
 });
}

window.eliminarProducto=async(id)=>{
 await deleteDoc(doc(db,"productos",id));
 cargarProductos();
};

/* CARRITO */
window.agregarCarrito=()=>{
 const select=document.getElementById("vProd");
 const opcion=select.selectedOptions[0];

 const nombre=opcion.textContent;
 const precio=parseFloat(opcion.dataset.precio);
 const litros=parseFloat(opcion.dataset.litros);
 const cantidad=parseInt(document.getElementById("vCant").value);

 carrito.push({
  nombre,
  cantidad,
  subtotal:precio*cantidad,
  litros:litros*cantidad
 });

 renderCarrito();
};

function renderCarrito(){
 const body=document.getElementById("carritoBody");
 const totalSpan=document.getElementById("totalVenta");

 body.innerHTML="";
 let total=0;

 carrito.forEach((item,i)=>{
  total+=item.subtotal;
  body.innerHTML+=`
   <tr>
    <td>${item.nombre}</td>
    <td>${item.cantidad}</td>
    <td>$${item.subtotal}</td>
    <td><button class="btn-danger" onclick="quitar(${i})">X</button></td>
   </tr>`;
 });

 totalSpan.textContent=total;
}

window.quitar=(i)=>{
 carrito.splice(i,1);
 renderCarrito();
};

/* GUARDAR VENTA */
window.guardarVenta=async()=>{
 if(!carrito.length) return alert("Carrito vacío");

 const totalVenta=carrito.reduce((a,b)=>a+b.subtotal,0);
 const litrosVenta=carrito.reduce((a,b)=>a+b.litros,0);

 await addDoc(collection(db,"ventas"),{
  items:carrito,
  total:totalVenta,
  litros:litrosVenta,
  fecha:new Date()
 });

 carrito=[];
 renderCarrito();
 alert("Venta guardada ✅");
};

/* PRODUCCIÓN */
window.calcularProduccion=async()=>{
 const ini=parseFloat(document.getElementById("pozoInicio").value);
 const fin=parseFloat(document.getElementById("pozoFinal").value);

 if(isNaN(ini)||isNaN(fin)) return alert("Completar lecturas");

 const extraido=(fin-ini)*1000;

 const ventas=await getDocs(collection(db,"ventas"));
 let litrosVendidos=0;
 ventas.forEach(v=>litrosVendidos+=v.data().litros);

 const desperdicio=extraido-litrosVendidos;

 document.getElementById("resultadoProduccion").innerHTML=
 `<div class="card">
  Extraído: ${extraido} L<br>
  Vendido: ${litrosVendidos} L<br>
  <b style="color:red">Diferencia: ${desperdicio} L</b>
 </div>`;
};

/* EGRESOS */
window.guardarEgreso=async()=>{
 const concepto=document.getElementById("eConcepto").value;
 const monto=parseFloat(document.getElementById("eMonto").value);

 if(!concepto||!monto) return alert("Completar datos");

 await addDoc(collection(db,"egresos"),{
  concepto,monto,fecha:new Date()
 });

 alert("Egreso guardado");
};

/* CIERRE */
window.generarCierre=async()=>{
 const ventas=await getDocs(collection(db,"ventas"));
 const egresos=await getDocs(collection(db,"egresos"));

 let totalVentas=0,totalEgresos=0;

 ventas.forEach(v=>totalVentas+=v.data().total);
 egresos.forEach(e=>totalEgresos+=e.data().monto);

 document.getElementById("informeCierre").innerHTML=
 `<div class="card">
  Total Ventas: $${totalVentas}<br>
  Total Egresos: $${totalEgresos}<br>
  <h3>Saldo: $${totalVentas-totalEgresos}</h3>
 </div>`;
};

window.onload=()=>{cargarProductos();}
</script>

</body>
</html>
